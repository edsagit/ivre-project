<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVRE - TUI</title>
    <!-- <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> -->
    <!-- Need to use version 1.1.0 due to errors with THREE.js on version 1.2.0 -->
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="js/Tone.js"></script>
    <script src="js/synth.js"></script>
    <!-- <script src="https://unpkg.com/aframe-text-plane"></script> -->
    <!-- <script src="js/mevents.js"></script> -->
    <!-- <script src="js/main.js"></script> -->
</head>

<script>

    // store visibility data in object;
    //  can only draw line when both are visible.
    let markerVisible2 = { m0: false, m1: false };

    AFRAME.registerComponent('registerevents', {
        init: function () {
            let marker = this.el;

            marker.addEventListener('markerFound', function () {
                markerVisible2[marker.id] = true;
            });

            marker.addEventListener('markerLost', function () {
                markerVisible2[marker.id] = false;
            });
        }
    });

    AFRAME.registerComponent('run', {
        init: function () {
            this.m0 = document.querySelector("#membrane");
            this.m1 = document.querySelector("#membraneBPM");
            this.m2 = document.querySelector("#membraneFREQ");
            this.p0 = new THREE.Vector3();
            this.p1 = new THREE.Vector3();
            this.p2 = new THREE.Vector3();

            this.geometry = new THREE.Geometry();
            this.geometry2 = new THREE.Geometry();
            this.geometry.vertices.push(new THREE.Vector3(-1, -1, -1));
            this.geometry.vertices.push(new THREE.Vector3(1, 1, 1));
            this.geometry2.vertices.push(new THREE.Vector3(-1, -1, -1));
            this.geometry2.vertices.push(new THREE.Vector3(1, 1, 1));
            this.material = new THREE.LineDashedMaterial({ color: "white", dashSize: 0.3, gapSize: 0.2 });
            this.line = new THREE.Line(this.geometry, this.material);
            this.line2 = new THREE.Line(this.geometry2, this.material);
            this.line.computeLineDistances();
            let scene = document.querySelector('a-scene').object3D;
            scene.add(this.line);
            scene.add(this.line2);
        },

        tick: function (time, deltaTime) {
            // get points positions
            this.m0.object3D.getWorldPosition(this.p0);
            this.m1.object3D.getWorldPosition(this.p1);
            this.m2.object3D.getWorldPosition(this.p2);
            // line from membrane to bpm
            this.geometry.vertices[0] = this.p0;
            this.geometry.vertices[1] = this.p1;
            // line from membrane to freq
            this.geometry2.vertices[0] = this.p0;
            this.geometry2.vertices[1] = this.p2;
            // update vertices
            this.geometry.verticesNeedUpdate = true;
            this.geometry2.verticesNeedUpdate = true;
            if (markerVisible2["membrane"] && markerVisible2["membraneBPM"]) {
                this.line.visible = true;
                // PRINT LINE DISTANCE between vector this.p0 and this.p1
                // console.log(this.p0.distanceTo(this.p1));
            }
            else {
                this.line.visible = false;
            }
            if (markerVisible2["membrane"] && markerVisible2["membraneFREQ"]) {
                this.line2.visible = true;
                // PRINT LINE DISTANCE between vector this.p0 and this.p2
                // console.log(this.p0.distanceTo(this.p2));
            }
            else {
                this.line2.visible = false;
            }
        }
    });

</script>

<body style="margin : 0px; overflow: hidden;">
    <a-scene vr-mode-ui="enabled: true;" renderer="logarithmicDepthBuffer: true;" embedded
        arjs="trackingMethod: best; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">

        <a-entity membrane></a-entity>
        <a-marker id="membrane" type='barcode' value='1' registerevents>
            <a-text id="membraneValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: teal; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <a-marker id="membraneBPM" type='barcode' value='2' registerevents>
            <a-ring id="membraneBPMRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <a-text id="membraneBPMValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: blue; transparent: false; opacity: 0.25; ">
            </a-plane>

        </a-marker>

        <a-marker id="membraneFREQ" type='barcode' value='3' registerevents>
            <a-ring id="membraneFREQRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <a-text id="membraneFREQValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: green; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <a-marker id="metal" type='barcode' value='4' registerevents>
            <a-text id="metalValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: red; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <a-marker id="metalCount" type='barcode' value='5' registerevents>
            <a-text id="metalCountValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: purple; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <a-marker id="metalFreq" type='barcode' value='6' registerevents>
            <a-text id="metalFreqValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: pink; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>



        <a-entity run=""></a-entity>

        <a-entity camera></a-entity>
    </a-scene>

</body>

</html>
