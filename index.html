<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVRE - TUI</title>
    <!-- <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> -->
    <!-- Need to use version 1.1.0 due to errors with THREE.js on version 1.2.0 -->
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="js/Tone.js"></script>
    <script src="js/synth.js"></script>
    <!-- <script src="https://unpkg.com/aframe-text-plane"></script> -->
    <!-- <script src="js/mevents.js"></script> -->
    <!-- <script src="js/main.js"></script> -->
</head>

<script>
    AFRAME.registerComponent('run', {
        init: function () {

            // MEMBRANE
            markerMembranePosition = new THREE.Vector3();
            markerMembraneBpmPosition = new THREE.Vector3();
            markerMembraneFreqPosition = new THREE.Vector3();

            // line bpm geometry
            this.lineBpmGeometry = new THREE.Geometry();
            this.lineBpmGeometry.vertices.push(new THREE.Vector3(-1, -1, -1));
            this.lineBpmGeometry.vertices.push(new THREE.Vector3(1, 1, 1));

            // line freq geometry
            this.lineFrequencyGeometry = new THREE.Geometry();
            this.lineFrequencyGeometry.vertices.push(new THREE.Vector3(-1, -1, -1));
            this.lineFrequencyGeometry.vertices.push(new THREE.Vector3(1, 1, 1));

            // METAL
            markerMetalPosition = new THREE.Vector3();
            markerMetalCountPosition = new THREE.Vector3();
            markerMetalDecayPosition = new THREE.Vector3();

            // line count geometry
            this.lineCountGeometry = new THREE.Geometry();
            this.lineCountGeometry.vertices.push(new THREE.Vector3(-1, -1, -1));
            this.lineCountGeometry.vertices.push(new THREE.Vector3(1, 1, 1));

            // line decay geometry
            this.lineDecayGeometry = new THREE.Geometry();
            this.lineDecayGeometry.vertices.push(new THREE.Vector3(-1, -1, -1));
            this.lineDecayGeometry.vertices.push(new THREE.Vector3(1, 1, 1));

            // line (dashed) material
            this.material = new THREE.LineDashedMaterial({ color: "white", dashSize: 0.3, gapSize: 0.2 });

            // assign lines
            this.lineBpm = new THREE.Line(this.lineBpmGeometry, this.material);
            this.lineFreq = new THREE.Line(this.lineFrequencyGeometry, this.material);
            this.lineCount = new THREE.Line(this.lineCountGeometry, this.material);
            this.lineDecay = new THREE.Line(this.lineDecayGeometry, this.material);

            // compute lines for bpm line to show dashed material
            this.lineBpm.computeLineDistances();

            // instantiate scene 
            let scene = document.querySelector('a-scene').object3D;

            // add previously created lines to the scene
            scene.add(this.lineBpm);
            scene.add(this.lineFreq);
            scene.add(this.lineCount);
            scene.add(this.lineDecay);
        },

        tick: function (time, deltaTime) {
            // get points positions
            markerMembrane.object3D.getWorldPosition(markerMembranePosition);
            markerMembraneBpm.object3D.getWorldPosition(markerMembraneBpmPosition);
            markerMembraneFreq.object3D.getWorldPosition(markerMembraneFreqPosition);
            markerMetal.object3D.getWorldPosition(markerMetalPosition);
            markerMetalCount.object3D.getWorldPosition(markerMetalCountPosition);
            markerMetalDecay.object3D.getWorldPosition(markerMetalDecayPosition);

            // line from membrane to bpm
            this.lineBpmGeometry.vertices[0] = markerMembranePosition;
            this.lineBpmGeometry.vertices[1] = markerMembraneBpmPosition;

            // line from membrane to freq
            this.lineFrequencyGeometry.vertices[0] = markerMembranePosition;
            this.lineFrequencyGeometry.vertices[1] = markerMembraneFreqPosition;

            // line from metal to count
            this.lineCountGeometry.vertices[0] = markerMetalPosition;
            this.lineCountGeometry.vertices[1] = markerMetalCountPosition;

            // line from metal to decay
            this.lineDecayGeometry.vertices[0] = markerMetalPosition;
            this.lineDecayGeometry.vertices[1] = markerMetalDecayPosition;

            // update vertices
            this.lineBpmGeometry.verticesNeedUpdate = true;
            this.lineFrequencyGeometry.verticesNeedUpdate = true;
            this.lineCountGeometry.verticesNeedUpdate = true;
            this.lineDecayGeometry.verticesNeedUpdate = true;

            // check if markers are visible in order to only draw the lines when their visibility is true
            // line membrane bpm visibility
            if (markerVisible["membrane"] && markerVisible["membraneBPM"]) {
                this.lineBpm.visible = true;
                // console.log(this.p0.distanceTo(this.p1));    // PRINT LINE DISTANCE between vector this.p0 and this.p1
            } else { this.lineBpm.visible = false; }
            // line membrane freq visibility
            if (markerVisible["membrane"] && markerVisible["membraneFREQ"]) {
                this.lineFreq.visible = true;
                // console.log(this.p0.distanceTo(this.p2));    // PRINT LINE DISTANCE between vector this.p0 and this.p2
            } else { this.lineFreq.visible = false; }
            // line metal count visibility
            if (markerVisible["metal"] && markerVisible["metalCount"]) {
                this.lineCount.visible = true;
                // console.log(this.p0.distanceTo(this.p2));    // PRINT LINE DISTANCE between vector this.p0 and this.p2
            } else { this.lineCount.visible = false; }
            // line metal decay visibility
            if (markerVisible["metal"] && markerVisible["metalDecay"]) {
                this.lineCount.visible = true;
                // console.log(this.p0.distanceTo(this.p2));    // PRINT LINE DISTANCE between vector this.p0 and this.p2
            } else { this.lineCount.visible = false; }
        }
    });

</script>

<body style="margin : 0px; overflow: hidden;">
    <a-scene vr-mode-ui="enabled: true;" renderer="logarithmicDepthBuffer: true;"
        arjs="trackingMethod: best; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        embedded>

        <a-entity membrane></a-entity>

        <!-- MEMBRANE -->
        <a-marker id="membrane" type='barcode' value='1' registerevents>
            <!-- marker text -->
            <a-text id="membraneValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: blue; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <!-- MEMBRANE BPM -->
        <a-marker id="membraneBPM" type='barcode' value='2' registerevents>
            <!-- marker ring -->
            <a-ring id="membraneBPMRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <!-- marker text -->
            <a-text id="membraneBPMValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: teal; transparent: false; opacity: 0.25; ">
            </a-plane>

        </a-marker>

        <!-- MEMBRANE FREQ -->
        <a-marker id="membraneFREQ" type='barcode' value='3' registerevents>
            <!-- marker ring -->
            <a-ring id="membraneFREQRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <!-- marker text -->
            <a-text id="membraneFREQValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: teal; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <!-- METAL -->
        <a-marker id="metal" type='barcode' value='4' registerevents>
            <!-- marker text -->
            <a-text id="metalValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: red; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>
        <!-- METAL COUNT -->
        <a-marker id="metalCount" type='barcode' value='5' registerevents>
            <!-- marker ring -->
            <a-ring id="metalCountRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <!-- marker text -->
            <a-text id="metalCountValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: purple; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <!-- METAL FREQ -->
        <a-marker id="metalDecay" type='barcode' value='6' registerevents>
            <!-- marker ring -->
            <a-ring id="metalDecayRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <!-- marker text -->
            <a-text id="metalDecayValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: purple; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <!-- OSCILLATOR -->
        <a-marker id="oscillator" type='barcode' value='8' registerevents>
            <!-- marker text -->
            <a-text id="oscillatorValue" value="" align="center" rotation="-90 0 0" position="0 0 0.65" color="#000">
            </a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: green; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>
        <!-- OSCILLATOR X -->
        <a-marker id="oscillatorFreq" type='barcode' value='9' registerevents>
            <!-- marker ring -->
            <a-ring id="oscillatorFreqRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <!-- marker text -->
            <a-text id="oscillatorFreqValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: yellow; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <!-- OSCILLATOR Y -->
        <a-marker id="oscillatorCount" type='barcode' value='10' registerevents>
            <!-- marker ring -->
            <a-ring id="oscillatorCountRing" color="white" radius-inner="0.5" radius-outer="0.6" rotation="-90 0 0"
                position="0 0.01 0" theta-length=""></a-ring>
            <!-- marker text -->
            <a-text id="oscillatorCountValue" value="" align="center" rotation="-90 0 0" position="0 0 0"></a-text>
            <!-- marker plane -->
            <a-plane position="0 0 0" rotation="-90 0 0" material="color: yellow; transparent: false; opacity: 0.25; ">
            </a-plane>
        </a-marker>

        <a-entity run=""></a-entity>

        <a-entity camera></a-entity>
    </a-scene>

</body>

</html>